//Storageexports.storage = function(db){	return function(req,res){		if (req.session.user_id) {			var storagecollection = db.get('storagecollection');			storagecollection.find({},{},function(err,docs){				var storageitemscollection = db.get('storageitemscollection');				storageitemscollection.find({},{},function(e,doc){					var itemsArr;					var storrageArr;					var i = 0;					while (doc[i]) {						itemsArr = JSON.stringify(doc);						storrageArr = JSON.stringify(docs);						i++;					}					res.render('storage',{						"storage" : docs,						storagejs: storrageArr,						itemsList: itemsArr,						title : "storage"					});				});			});		}else{			res.render('signIn');		};	};};//Storage itemsexports.storageItems = function(db){	return function(req,res){		if (req.session.user_id) {			var storageitemscollection = db.get('storageitemscollection');			storageitemscollection.find({},{},function(e,docs){				var unitscollection = db.get('unitscollection');				unitscollection.find({},{},function(err,doc){					var unitsArr;					var i = 0;					while (doc[i]) {						unitsArr = JSON.stringify(doc);						i++;					}					res.render('storage_items',{						"storage_items" : docs,						"uts":doc,						units:unitsArr,						title:"storage_items"					});				});			});		}else{			res.render('signIn');		};	};};//Add Storage item Formexports.addstorageitem =  function(db){	return function(req,res){		if (req.session.user_id) {			//Get Input Submissions			var title = req.body.title;			var pack = req.body.pack;			var package_unit = req.body.package_unit;			var ration = req.body.ration;			var ration_unit = req.body.ration_unit;			var sell_price = req.body.sell_price;						//Set Items Collection			var itemsCol = db.get('storageitemscollection');						//Submit Items to the DB			itemsCol.insert({				"title" : title,				"package" : pack,				"package_unit":package_unit,				"ration" : ration,				"ration_unit" : ration_unit,				"sell_price" : sell_price,				"deleted" : "0"			},function(err,doc){				if(err){					res.send('There was a problem');				} else {					//Set Storage Collection					var storageCol = db.get('storagecollection');					itemsCol.find({},{},function(error,entries){						var lastEntry = entries.sort({_id:1})[entries.length-1];						storageCol.insert({							"storage_item":lastEntry._id,							"amount":"0"						},function(e,d){							if(e){								res.send('There was a problem');							}else{								res.location('storage_items');								res.redirect('storage_items');							}						});									});				}			});		}else{			res.render('signIn');		};			};}; //Units Listexports.units = function(db){	return function(req,res){		if (req.session.user_id) {			var collection = db.get('unitscollection');			collection.find({},{},function(e,docs){				res.render('units',{					"units" : docs,					title : "units"				});			});		}else{			res.render('signIn');		};		};};//Add Unit Formexports.addunit =  function(db){	return function(req,res){		if (req.session.user_id) {			//Get Input Submissions			var title = req.body.title;			var sign = req.body.sign;			var subunit = req.body.subunit;			var subunit_sign = req.body.subunit_sign;			var conversion = req.body.conversion						//Set Collection			var collection = db.get('unitscollection');						//Submit to the DB			collection.insert({				"title" : title,				"sign" : sign,				"subunit" : subunit,				"subunit_sign" : subunit_sign,				"conversion" : conversion,				"deleted":"0"			},function(err,doc){				if(err){					res.send('There was a problem');				} else {					res.location('units');					res.redirect('units');				}			});		}else{			res.render('signIn');		};		};}; 